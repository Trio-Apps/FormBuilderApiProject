# Ø£Ù…Ø«Ù„Ø© Ø§Ù„ØªØ­Ø³ÙŠÙ†Ø§Øª ÙˆØ§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…ØªØ£Ø«Ø±Ø© - FormBuilder API Project

**ØªØ§Ø±ÙŠØ®:** 2024-12-19

---

## ğŸ”´ 1. ØªØ­ÙˆÙŠÙ„ FormulaService Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… ServiceResult Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† ApiResponse

### ğŸ“‹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©:

1. **FormBuilder.Services/Services/FormBuilder/FormulaService.cs** (~58 methods)
2. **frombuilderApiProject/Controllers/FormBuilder/FormulasController.cs** (~30+ endpoints)
3. **FormBuilder.Core/IServices/FormBuilder/IFormulaService.cs** (Interface)

---

### ğŸ“ Ø£Ù…Ø«Ù„Ø© Ø§Ù„ÙƒÙˆØ¯ Ù‚Ø¨Ù„ ÙˆØ¨Ø¹Ø¯:

#### Ù…Ø«Ø§Ù„ 1: GetAllAsync

**âŒ Ù‚Ø¨Ù„ (ApiResponse):**
```csharp
public async Task<ApiResponse> GetAllAsync(int formBuilderId)
{
    var formulas = await _formulasRepository.GetByFormBuilderAsync(formBuilderId);
    var formulaDtos = _mapper.Map<IEnumerable<FormulaDto>>(formulas);
    return new ApiResponse(200, "Formulas retrieved successfully", formulaDtos);
}
```

**âœ… Ø¨Ø¹Ø¯ (ServiceResult):**
```csharp
public async Task<ServiceResult<IEnumerable<FormulaDto>>> GetAllAsync(int formBuilderId)
{
    var formulas = await _formulasRepository.GetByFormBuilderAsync(formBuilderId);
    var formulaDtos = _mapper.Map<IEnumerable<FormulaDto>>(formulas);
    return ServiceResult<IEnumerable<FormulaDto>>.Ok(formulaDtos);
}
```

---

#### Ù…Ø«Ø§Ù„ 2: GetByIdAsync

**âŒ Ù‚Ø¨Ù„ (ApiResponse):**
```csharp
public async Task<ApiResponse> GetByIdAsync(int id)
{
    var result = await base.GetByIdAsync(id);
    return ConvertToApiResponse(result);
}
```

**âœ… Ø¨Ø¹Ø¯ (ServiceResult):**
```csharp
public async Task<ServiceResult<FormulaDto>> GetByIdAsync(int id)
{
    return await base.GetByIdAsync(id, asNoTracking: true);
}
```

---

#### Ù…Ø«Ø§Ù„ 3: GetByCodeAsync

**âŒ Ù‚Ø¨Ù„ (ApiResponse):**
```csharp
public async Task<ApiResponse> GetByCodeAsync(string code, int formBuilderId)
{
    var formula = await _formulasRepository.GetByCodeAsync(code, formBuilderId);
    if (formula == null)
        return new ApiResponse(404, "Formula not found");

    var formulaDto = _mapper.Map<FormulaDto>(formula);
    return new ApiResponse(200, "Formula retrieved successfully", formulaDto);
}
```

**âœ… Ø¨Ø¹Ø¯ (ServiceResult):**
```csharp
public async Task<ServiceResult<FormulaDto>> GetByCodeAsync(string code, int formBuilderId)
{
    if (string.IsNullOrWhiteSpace(code))
        return ServiceResult<FormulaDto>.BadRequest("Formula code is required");

    var formula = await _formulasRepository.GetByCodeAsync(code, formBuilderId);
    if (formula == null)
        return ServiceResult<FormulaDto>.NotFound();

    var formulaDto = _mapper.Map<FormulaDto>(formula);
    return ServiceResult<FormulaDto>.Ok(formulaDto);
}
```

---

#### Ù…Ø«Ø§Ù„ 4: CreateAsync

**âŒ Ù‚Ø¨Ù„ (ApiResponse):**
```csharp
public async Task<ApiResponse> CreateAsync(CreateFormulaDto createDto)
{
    if (createDto == null)
        return new ApiResponse(400, "DTO is required");

    // Validate form builder exists
    var formBuilderExists = await _unitOfWork.FormBuilderRepository
        .AnyAsync(fb => fb.Id == createDto.FormBuilderId);

    if (!formBuilderExists)
        return new ApiResponse(404, "Form builder not found");

    // ... validation logic ...

    var result = await base.CreateAsync(createDto);
    if (!result.Success)
        return ConvertToApiResponse(result);

    // Get created formula with details
    var createdFormula = await _formulasRepository.GetByIdWithDetailsAsync(result.Data.Id);
    var formulaDto = _mapper.Map<FormulaDto>(createdFormula);
    return new ApiResponse(200, "Formula created successfully", formulaDto);
}
```

**âœ… Ø¨Ø¹Ø¯ (ServiceResult):**
```csharp
public override async Task<ServiceResult<FormulaDto>> CreateAsync(CreateFormulaDto createDto)
{
    if (createDto == null)
        return ServiceResult<FormulaDto>.BadRequest("DTO is required");

    // Validate form builder exists
    var formBuilderExists = await _unitOfWork.FormBuilderRepository
        .AnyAsync(fb => fb.Id == createDto.FormBuilderId);

    if (!formBuilderExists)
        return ServiceResult<FormulaDto>.NotFound("Form builder not found");

    // ... validation logic ...

    var result = await base.CreateAsync(createDto);
    if (!result.Success)
        return result;

    // Use result.Data directly instead of GetByIdWithDetailsAsync
    return ServiceResult<FormulaDto>.Ok(result.Data);
}
```

---

#### Ù…Ø«Ø§Ù„ 5: UpdateAsync

**âŒ Ù‚Ø¨Ù„ (ApiResponse):**
```csharp
public async Task<ApiResponse> UpdateAsync(int id, UpdateFormulaDto updateDto)
{
    if (updateDto == null)
        return new ApiResponse(400, "DTO is required");

    var entity = await _formulasRepository.SingleOrDefaultAsync(f => f.Id == id, asNoTracking: false);
    if (entity == null)
        return new ApiResponse(404, "Formula not found");

    // ... validation logic ...

    var result = await base.UpdateAsync(id, updateDto);
    if (!result.Success)
        return ConvertToApiResponse(result);

    // Get updated formula with details
    var updatedFormula = await _formulasRepository.GetByIdWithDetailsAsync(id);
    var formulaDto = _mapper.Map<FormulaDto>(updatedFormula);
    return new ApiResponse(200, "Formula updated successfully", formulaDto);
}
```

**âœ… Ø¨Ø¹Ø¯ (ServiceResult):**
```csharp
public override async Task<ServiceResult<FormulaDto>> UpdateAsync(int id, UpdateFormulaDto updateDto)
{
    if (updateDto == null)
        return ServiceResult<FormulaDto>.BadRequest("DTO is required");

    // ... validation logic ...

    var result = await base.UpdateAsync(id, updateDto);
    if (!result.Success)
        return result;

    // Use result.Data directly instead of GetByIdWithDetailsAsync
    return ServiceResult<FormulaDto>.Ok(result.Data);
}
```

---

#### Ù…Ø«Ø§Ù„ 6: Controller - GetAllAsync

**âŒ Ù‚Ø¨Ù„ (ApiResponse):**
```csharp
[HttpGet("form-builder/{formBuilderId}")]
public async Task<IActionResult> GetByFormBuilder(int formBuilderId)
{
    var result = await _formulaService.GetAllAsync(formBuilderId);
    return StatusCode(result.StatusCode, result);
}
```

**âœ… Ø¨Ø¹Ø¯ (ServiceResult):**
```csharp
[HttpGet("form-builder/{formBuilderId}")]
public async Task<IActionResult> GetByFormBuilder(int formBuilderId)
{
    var result = await _formulaService.GetAllAsync(formBuilderId);
    return result.ToActionResult();
}
```

---

#### Ù…Ø«Ø§Ù„ 7: Controller - CreateAsync

**âŒ Ù‚Ø¨Ù„ (ApiResponse):**
```csharp
[HttpPost]
public async Task<IActionResult> Create([FromBody] CreateFormulaDto createDto)
{
    if (!ModelState.IsValid)
        return BadRequest(new ApiResponse(400, "Invalid model state", ModelState));

    var result = await _formulaService.CreateAsync(createDto);
    return StatusCode(result.StatusCode, result);
}
```

**âœ… Ø¨Ø¹Ø¯ (ServiceResult):**
```csharp
[HttpPost]
public async Task<IActionResult> Create([FromBody] CreateFormulaDto createDto)
{
    if (!ModelState.IsValid)
        return BadRequest(ModelState);

    var result = await _formulaService.CreateAsync(createDto);
    if (result.Success && result.Data != null)
    {
        return CreatedAtAction(nameof(GetById), new { id = result.Data.Id }, result.Data);
    }
    return result.ToActionResult();
}
```

---

### ğŸ“Š Methods Ø§Ù„ØªÙŠ ØªØ­ØªØ§Ø¬ ØªØ­ÙˆÙŠÙ„ ÙÙŠ FormulaService:

1. `GetAllAsync(int formBuilderId)`
2. `GetByIdAsync(int id)`
3. `GetByCodeAsync(string code, int formBuilderId)`
4. `CreateAsync(CreateFormulaDto createDto)`
5. `UpdateAsync(int id, UpdateFormulaDto updateDto)`
6. `DeleteAsync(int id)`
7. `GetActiveAsync(int formBuilderId)`
8. `GetInactiveAsync(int formBuilderId)`
9. `GetFormulasWithDetailsAsync(int formBuilderId = 0)`
10. `GetByIdWithDetailsAsync(int id)`
11. `GetByResultFieldAsync(int? resultFieldId)`
12. `GetFormulasWithoutResultFieldAsync(int formBuilderId)`
13. `SearchFormulasAsync(string searchTerm, int formBuilderId)`
14. `ValidateExpressionAsync(ValidateExpressionDto validationDto)`
15. `ValidateExpressionWithDetailsAsync(ValidateExpressionDto validationDto)`
16. `CodeExistsAsync(string code, int formBuilderId, int? excludeId = null)`
17. `IsActiveAsync(int id)`
18. `HasActiveFormulasAsync(int formBuilderId)`
19. `GetReferencedFieldCodesAsync(int formulaId)`
20. `CountFormulasAsync(int formBuilderId)`
21. `UpdateFormulaExpressionAsync(int id, string expressionText)`
22. `GetFieldCodesForFormAsync(int formBuilderId)`
23. `GetFormulaVariablesAsync(int formulaId)`
24. `CountVariablesAsync(int formulaId)`
25. `HasVariablesAsync(int formulaId)`
26. `GetFormulasByFieldAsync(int fieldId)`
27. `GetFormulaStatisticsAsync(int formBuilderId)`
28. `BatchUpdateFormulaStatusAsync(List<int> formulaIds, bool isActive)`
29. `DuplicateFormulaAsync(int sourceFormulaId, DuplicateFormulaDto duplicateDto)`
30. `CalculateFormulaAsync(int formulaId, Dictionary<string, object> fieldValues)`
31. `CalculateExpressionAsync(string expressionText, Dictionary<string, object> fieldValues)`
32. `CalculateWithAllOperationsAsync(string expressionText, Dictionary<string, object> fieldValues)`
33. `SafeCalculateExpressionAsync(string expressionText, Dictionary<string, object> fieldValues)`
34. `BatchCalculateFormulasAsync(int formBuilderId, Dictionary<string, object> fieldValues)`
35. `PreviewCalculationAsync(PreviewCalculationDto previewDto)`
36. `TestFormulaWithSampleDataAsync(int formulaId)`
37. `ToggleActiveAsync(int id, bool isActive)`
38. `DeleteByFormBuilderIdAsync(int formBuilderId)`

---

## ğŸ”´ 2. Ø¥Ø²Ø§Ù„Ø© Try-Catch Ù…Ù† Controllers

### ğŸ“‹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©:

1. **frombuilderApiProject/Controllers/FormBuilder/FormBuilderController.cs**
2. **frombuilderApiProject/Controllers/FormBuilder/ProjectsController.cs**
3. **frombuilderApiProject/Controllers/FormBuilder/FormTabsController.cs**
4. **frombuilderApiProject/Controllers/FormBuilder/FormFieldsController.cs**
5. **frombuilderApiProject/Controllers/FormBuilder/FieldTypesController.cs**
6. **frombuilderApiProject/Controllers/FormBuilder/DocumentTypesController.cs**
7. **frombuilderApiProject/Controllers/FormBuilder/DocumentSeriesController.cs**
8. **frombuilderApiProject/Controllers/FormBuilder/AttachmentTypesController.cs**
9. **frombuilderApiProject/Controllers/FormBuilder/FormAttachmentTypesController.cs**
10. **frombuilderApiProject/Controllers/FormBuilder/FormGridsController.cs**
11. **frombuilderApiProject/Controllers/FormBuilder/FormGridColumnsController.cs**
12. **frombuilderApiProject/Controllers/FormBuilder/FormRulesController.cs**
13. **frombuilderApiProject/Controllers/FormBuilder/FormulasController.cs**
14. **frombuilderApiProject/Controllers/FormBuilder/FormulaVariablesController.cs**
15. **frombuilderApiProject/Controllers/FormBuilder/FormSubmissionsController.cs**
16. **frombuilderApiProject/Controllers/FormBuilder/FormSubmissionValuesController.cs**
17. **frombuilderApiProject/Controllers/FormBuilder/FormSubmissionAttachmentsController.cs**
18. **frombuilderApiProject/Controllers/FormBuilder/FormSubmissionGridRowsController.cs**
19. **frombuilderApiProject/Controllers/FormBuilder/FormSubmissionGridCellsController.cs**
20. **frombuilderApiProject/Controllers/FormBuilder/ApprovalStageController.cs**
21. **frombuilderApiProject/Controllers/FormBuilder/ApprovalWorkflowController.cs**
22. **frombuilderApiProject/Controllers/Auth/AccountController.cs**
23. **frombuilderApiProject/Controllers/Auth/RolesController.cs**
24. **frombuilderApiProject/Controllers/Auth/UserPermissionController.cs**

---

### ğŸ“ Ø£Ù…Ø«Ù„Ø© Ø§Ù„ÙƒÙˆØ¯ Ù‚Ø¨Ù„ ÙˆØ¨Ø¹Ø¯:

#### Ù…Ø«Ø§Ù„ 1: FormBuilderController - CreateAsync

**âŒ Ù‚Ø¨Ù„ (Ù…Ø¹ Try-Catch):**
```csharp
[HttpPost]
public async Task<IActionResult> CreateForm([FromBody] CreateFormBuilderDto createDto)
{
    if (!ModelState.IsValid)
    {
        return BadRequest(ModelState);
    }

    var currentUserId = User.FindFirstValue(ClaimTypes.NameIdentifier);
    if (string.IsNullOrEmpty(currentUserId))
    {
        return Unauthorized("User ID not found in claims.");
    }

    try
    {
        createDto.CreatedByUserId = currentUserId;
        var result = await _formBuilderService.CreateAsync(createDto);
        if (result.Success && result.Data != null)
        {
            return CreatedAtAction(nameof(GetFormById), new { id = result.Data.Id }, result.Data);
        }
        return result.ToActionResult();
    }
    catch (InvalidOperationException ex) when (ex.Message.Contains("Form code"))
    {
        return Conflict(ex.Message);
    }
    catch (Exception ex)
    {
        return BadRequest(ex.Message);
    }
}
```

**âœ… Ø¨Ø¹Ø¯ (Ø¨Ø¯ÙˆÙ† Try-Catch):**
```csharp
[HttpPost]
public async Task<IActionResult> CreateForm([FromBody] CreateFormBuilderDto createDto)
{
    if (!ModelState.IsValid)
    {
        return BadRequest(ModelState);
    }

    var currentUserId = User.FindFirstValue(ClaimTypes.NameIdentifier);
    if (string.IsNullOrEmpty(currentUserId))
    {
        return Unauthorized("User ID not found in claims.");
    }

    createDto.CreatedByUserId = currentUserId;
    var result = await _formBuilderService.CreateAsync(createDto);
    
    if (result.Success && result.Data != null)
    {
        return CreatedAtAction(nameof(GetFormById), new { id = result.Data.Id }, result.Data);
    }
    
    return result.ToActionResult();
}
```

---

#### Ù…Ø«Ø§Ù„ 2: FormBuilderController - UpdateAsync

**âŒ Ù‚Ø¨Ù„ (Ù…Ø¹ Try-Catch):**
```csharp
[HttpPut("{id}")]
public async Task<IActionResult> UpdateForm(int id, [FromBody] UpdateFormBuilderDto updateDto)
{
    if (!ModelState.IsValid)
    {
        return BadRequest(ModelState);
    }

    try
    {
        var result = await _formBuilderService.UpdateAsync(id, updateDto);
        if (result.Success)
        {
            return NoContent();
        }
        return result.ToActionResult();
    }
    catch (InvalidOperationException ex) when (ex.Message.Contains("Form code"))
    {
        return Conflict(ex.Message);
    }
    catch (Exception ex)
    {
        return BadRequest(ex.Message);
    }
}
```

**âœ… Ø¨Ø¹Ø¯ (Ø¨Ø¯ÙˆÙ† Try-Catch):**
```csharp
[HttpPut("{id}")]
public async Task<IActionResult> UpdateForm(int id, [FromBody] UpdateFormBuilderDto updateDto)
{
    if (!ModelState.IsValid)
    {
        return BadRequest(ModelState);
    }

    var result = await _formBuilderService.UpdateAsync(id, updateDto);
    if (result.Success)
    {
        return NoContent();
    }
    
    return result.ToActionResult();
}
```

---

## ğŸ”´ 3. ØªÙˆØ­ÙŠØ¯ Namespaces

### ğŸ“‹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©:

#### 3.1 Domain Layer (~50+ files):

**âŒ Ù‚Ø¨Ù„:**
- `formBuilder.Domian.Entitys` â†’ **âœ… Ø¨Ø¹Ø¯:** `FormBuilder.Domain.Entities`
- `FormBuilder.Domian.Entitys.FormBuilder` â†’ **âœ… Ø¨Ø¹Ø¯:** `FormBuilder.Domain.Entities.FormBuilder`
- `FormBuilder.Domian.Entitys.FromBuilder` â†’ **âœ… Ø¨Ø¹Ø¯:** `FormBuilder.Domain.Entities.FormBuilder`
- `FormBuilder.Domian.Entitys.froms` â†’ **âœ… Ø¨Ø¹Ø¯:** `FormBuilder.Domain.Entities.Forms`
- `formBuilder.Domian.Interfaces` â†’ **âœ… Ø¨Ø¹Ø¯:** `FormBuilder.Domain.Interfaces`
- `FormBuilder.Domian.Interfaces` â†’ **âœ… Ø¨Ø¹Ø¯:** `FormBuilder.Domain.Interfaces`
- `FormBuilder.Domain.Interfaces.Repositories` â†’ **âœ… Ø¨Ø¹Ø¯:** `FormBuilder.Domain.Interfaces`

**Ø§Ù„Ù…Ù„ÙØ§Øª:**
1. `formBuilder.Domian/Entitys/BaseEntity.cs`
2. `formBuilder.Domian/Entitys/FormBuilder/*.cs` (~30 files)
3. `formBuilder.Domian/Interfaces/IBaseRepository.cs`
4. `formBuilder.Domian/Interfaces/IunitOfwork.cs`
5. `formBuilder.Domian/Interfaces/IFormBuilderRepository.cs`
6. `formBuilder.Domian/Interfaces/IFormTabRepository.cs`
7. `formBuilder.Domian/Interfaces/IFormFieldRepository.cs`
8. `formBuilder.Domian/Interfaces/IFieldTypesRepository.cs`
9. `formBuilder.Domian/Interfaces/IFORM_RULESRepository.cs`
10. `formBuilder.Domian/Interfaces/IFieldOptionsRepository.cs`
11. `formBuilder.Domian/Interfaces/IFieldDataSourcesRepository.cs`
12. `formBuilder.Domian/Interfaces/IAttachmentTypeRepository.cs`
13. `formBuilder.Domian/Interfaces/IFormAttachmentTypeRepository.cs`
14. `formBuilder.Domian/Interfaces/IDocumentTypeRepository.cs`
15. `formBuilder.Domian/Interfaces/IProjectRepository.cs`
16. `formBuilder.Domian/Interfaces/IDocumentSeriesRepository.cs`
17. `formBuilder.Domian/Interfaces/IFormSubmissionsRepository.cs`
18. `formBuilder.Domian/Interfaces/IFormSubmissionValuesRepository.cs`
19. `formBuilder.Domian/Interfaces/IFormSubmissionAttachmentsRepository.cs`
20. `formBuilder.Domian/Interfaces/IFormGridRepository.cs`
21. `formBuilder.Domian/Interfaces/IFormGridColumnRepository.cs`
22. `formBuilder.Domian/Interfaces/IFormSubmissionGridRowRepository.cs`
23. `formBuilder.Domian/Interfaces/IFormSubmissionGridCellRepository.cs`
24. `formBuilder.Domian/Interfaces/IFormulasRepository.cs`
25. `formBuilder.Domian/Interfaces/IFormulaVariablesRepository.cs`
26. `formBuilder.Domian/Interfaces/IApprovalStageRepository.cs`
27. `formBuilder.Domian/Interfaces/IApprovalWorkflowRepository.cs`
28. `formBuilder.Domian/Interfaces/IWorkflowRepository.cs`

#### 3.2 Services Layer (~30+ files):

**âŒ Ù‚Ø¨Ù„:**
- `FormBuilder.Services` â†’ **âœ… Ø¨Ø¹Ø¯:** `FormBuilder.Services`
- `FormBuilder.Services.Services` â†’ **âœ… Ø¨Ø¹Ø¯:** `FormBuilder.Services`
- `FormBuilder.core` â†’ **âœ… Ø¨Ø¹Ø¯:** `FormBuilder.Services`

**Ø§Ù„Ù…Ù„ÙØ§Øª:**
1. `FormBuilder.Services/Services/Base/BaseService.cs`
2. `FormBuilder.Services/Services/FormBuilder/*.cs` (~25 files)
3. `FormBuilder.Services/Repository/BaseRepository.cs`
4. `FormBuilder.Services/Repository/*.cs` (~20 files)

#### 3.3 Controllers Layer (~25 files):

**âŒ Ù‚Ø¨Ù„:**
- `FormBuilder.API.Controllers` â†’ **âœ… Ø¨Ø¹Ø¯:** `FormBuilder.API.Controllers`
- `FormBuilder.ApiProject.Controllers.FormBuilder` â†’ **âœ… Ø¨Ø¹Ø¯:** `FormBuilder.API.Controllers.FormBuilder`
- `FormBuilder.API.Controllers` â†’ **âœ… Ø¨Ø¹Ø¯:** `FormBuilder.API.Controllers`

---

### ğŸ“ Ø£Ù…Ø«Ù„Ø© Ø§Ù„ÙƒÙˆØ¯ Ù‚Ø¨Ù„ ÙˆØ¨Ø¹Ø¯:

#### Ù…Ø«Ø§Ù„ 1: Entity File

**âŒ Ù‚Ø¨Ù„:**
```csharp
using formBuilder.Domian.Entitys;
using FormBuilder.Domian.Entitys.FormBuilder;

namespace FormBuilder.Domian.Entitys.FromBuilder
{
    [Table("PROJECTS")]
    public class PROJECTS : BaseEntity
    {
        // ...
    }
}
```

**âœ… Ø¨Ø¹Ø¯:**
```csharp
using FormBuilder.Domain.Entities;
using FormBuilder.Domain.Entities.FormBuilder;

namespace FormBuilder.Domain.Entities.FormBuilder
{
    [Table("PROJECTS")]
    public class PROJECTS : BaseEntity
    {
        // ...
    }
}
```

---

#### Ù…Ø«Ø§Ù„ 2: Repository Interface

**âŒ Ù‚Ø¨Ù„:**
```csharp
using formBuilder.Domian.Interfaces;
using FormBuilder.Domian.Entitys.FormBuilder;

namespace FormBuilder.Domain.Interfaces.Repositories
{
    public interface IFormBuilderRepository : IBaseRepository<FORM_BUILDER>
    {
        // ...
    }
}
```

**âœ… Ø¨Ø¹Ø¯:**
```csharp
using FormBuilder.Domain.Interfaces;
using FormBuilder.Domain.Entities.FormBuilder;

namespace FormBuilder.Domain.Interfaces
{
    public interface IFormBuilderRepository : IBaseRepository<FORM_BUILDER>
    {
        // ...
    }
}
```

---

#### Ù…Ø«Ø§Ù„ 3: Service File

**âŒ Ù‚Ø¨Ù„:**
```csharp
using formBuilder.Domian.Interfaces;
using FormBuilder.Domian.Entitys.FormBuilder;

namespace FormBuilder.Services.Services
{
    public class FormTabService : BaseService<FORM_TABS, FormTabDto, CreateFormTabDto, UpdateFormTabDto>
    {
        // ...
    }
}
```

**âœ… Ø¨Ø¹Ø¯:**
```csharp
using FormBuilder.Domain.Interfaces;
using FormBuilder.Domain.Entities.FormBuilder;

namespace FormBuilder.Services
{
    public class FormTabService : BaseService<FORM_TABS, FormTabDto, CreateFormTabDto, UpdateFormTabDto>
    {
        // ...
    }
}
```

---

## ğŸŸ¡ 4. Ø¥Ø²Ø§Ù„Ø© GetById Ø¨Ø¹Ø¯ Create

### ğŸ“‹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©:

1. **FormBuilder.Services/Services/FormBuilder/DocumentSeriesService.cs**
   - Method: `GetNextNumberAsync` (Ø§Ù„Ø³Ø·Ø± 170)

2. **FormBuilder.Services/Services/FormBuilder/FormulaService.cs**
   - Method: `CreateAsync` (Ø§Ù„Ø³Ø·Ø± 97)
   - Method: `UpdateAsync` (Ø§Ù„Ø³Ø·Ø± 160)

3. **FormBuilder.Services/Services/FormBuilder/FormSubmissionService.cs**
   - Method: `CreateAsync` (Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯)

---

### ğŸ“ Ø£Ù…Ø«Ù„Ø© Ø§Ù„ÙƒÙˆØ¯ Ù‚Ø¨Ù„ ÙˆØ¨Ø¹Ø¯:

#### Ù…Ø«Ø§Ù„ 1: DocumentSeriesService.GetNextNumberAsync

**âŒ Ù‚Ø¨Ù„:**
```csharp
public async Task<ApiResponse> GetNextNumberAsync(int seriesId)
{
    var nextNumber = await _unitOfWork.DocumentSeriesRepository.GetNextNumberAsync(seriesId);
    if (nextNumber == -1)
        return new ApiResponse(404, "Document series not found");

    // âŒ Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø¥Ø¶Ø§ÙÙŠ ØºÙŠØ± Ø¶Ø±ÙˆØ±ÙŠ
    var series = await _unitOfWork.DocumentSeriesRepository.GetByIdAsync(seriesId);
    var result = new DocumentSeriesNumberDto
    {
        SeriesId = seriesId,
        SeriesCode = series.SeriesCode,
        NextNumber = nextNumber,
        FullNumber = $"{series.SeriesCode}-{nextNumber:D6}"
    };

    return new ApiResponse(200, "Next number retrieved successfully", result);
}
```

**âœ… Ø¨Ø¹Ø¯:**
```csharp
public async Task<ServiceResult<DocumentSeriesNumberDto>> GetNextNumberAsync(int seriesId)
{
    // âœ… Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© Ù…Ø¹ NextNumber
    var series = await _unitOfWork.DocumentSeriesRepository.SingleOrDefaultAsync(
        s => s.Id == seriesId, asNoTracking: true);
    
    if (series == null)
        return ServiceResult<DocumentSeriesNumberDto>.NotFound("Document series not found");

    var nextNumber = await _unitOfWork.DocumentSeriesRepository.GetNextNumberAsync(seriesId);
    if (nextNumber == -1)
        return ServiceResult<DocumentSeriesNumberDto>.NotFound("Document series not found");

    var result = new DocumentSeriesNumberDto
    {
        SeriesId = seriesId,
        SeriesCode = series.SeriesCode,
        NextNumber = nextNumber,
        FullNumber = $"{series.SeriesCode}-{nextNumber:D6}"
    };

    return ServiceResult<DocumentSeriesNumberDto>.Ok(result);
}
```

---

#### Ù…Ø«Ø§Ù„ 2: FormulaService.CreateAsync

**âŒ Ù‚Ø¨Ù„:**
```csharp
public async Task<ApiResponse> CreateAsync(CreateFormulaDto createDto)
{
    // ... validation logic ...

    var result = await base.CreateAsync(createDto);
    if (!result.Success)
        return ConvertToApiResponse(result);

    // âŒ Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø¥Ø¶Ø§ÙÙŠ ØºÙŠØ± Ø¶Ø±ÙˆØ±ÙŠ
    var createdFormula = await _formulasRepository.GetByIdWithDetailsAsync(result.Data.Id);
    var formulaDto = _mapper.Map<FormulaDto>(createdFormula);
    return new ApiResponse(200, "Formula created successfully", formulaDto);
}
```

**âœ… Ø¨Ø¹Ø¯:**
```csharp
public override async Task<ServiceResult<FormulaDto>> CreateAsync(CreateFormulaDto createDto)
{
    // ... validation logic ...

    var result = await base.CreateAsync(createDto);
    if (!result.Success)
        return result;

    // âœ… Ø§Ø³ØªØ®Ø¯Ø§Ù… result.Data Ù…Ø¨Ø§Ø´Ø±Ø©
    return ServiceResult<FormulaDto>.Ok(result.Data);
}
```

---

#### Ù…Ø«Ø§Ù„ 3: FormulaService.UpdateAsync

**âŒ Ù‚Ø¨Ù„:**
```csharp
public async Task<ApiResponse> UpdateAsync(int id, UpdateFormulaDto updateDto)
{
    // ... validation logic ...

    var result = await base.UpdateAsync(id, updateDto);
    if (!result.Success)
        return ConvertToApiResponse(result);

    // âŒ Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø¥Ø¶Ø§ÙÙŠ ØºÙŠØ± Ø¶Ø±ÙˆØ±ÙŠ
    var updatedFormula = await _formulasRepository.GetByIdWithDetailsAsync(id);
    var formulaDto = _mapper.Map<FormulaDto>(updatedFormula);
    return new ApiResponse(200, "Formula updated successfully", formulaDto);
}
```

**âœ… Ø¨Ø¹Ø¯:**
```csharp
public override async Task<ServiceResult<FormulaDto>> UpdateAsync(int id, UpdateFormulaDto updateDto)
{
    // ... validation logic ...

    var result = await base.UpdateAsync(id, updateDto);
    if (!result.Success)
        return result;

    // âœ… Ø§Ø³ØªØ®Ø¯Ø§Ù… result.Data Ù…Ø¨Ø§Ø´Ø±Ø©
    return ServiceResult<FormulaDto>.Ok(result.Data);
}
```

---

## ğŸŸ¡ 5. ØªÙˆØ­ÙŠØ¯ Response Patterns ÙÙŠ Controllers

### ğŸ“‹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©:

Ø¬Ù…ÙŠØ¹ Controllers ÙÙŠ `frombuilderApiProject/Controllers/` (~25 files)

---

### ğŸ“ Ø£Ù…Ø«Ù„Ø© Ø§Ù„ÙƒÙˆØ¯ Ù‚Ø¨Ù„ ÙˆØ¨Ø¹Ø¯:

#### Ù…Ø«Ø§Ù„ 1: ØªÙˆØ­ÙŠØ¯ Create Response

**âŒ Ù‚Ø¨Ù„ (Ø£Ù†Ù…Ø§Ø· Ù…Ø®ØªÙ„ÙØ©):**
```csharp
// FormBuilderController.cs
[HttpPost]
public async Task<IActionResult> CreateForm([FromBody] CreateFormBuilderDto createDto)
{
    var result = await _formBuilderService.CreateAsync(createDto);
    if (result.Success && result.Data != null)
    {
        return CreatedAtAction(nameof(GetFormById), new { id = result.Data.Id }, result.Data);
    }
    return result.ToActionResult();
}

// ProjectsController.cs
[HttpPost]
public async Task<IActionResult> Create([FromBody] CreateProjectDto createDto)
{
    var result = await _projectService.CreateAsync(createDto);
    return result.ToActionResult(); // âŒ Ù„Ø§ ÙŠØ³ØªØ®Ø¯Ù… CreatedAtAction
}
```

**âœ… Ø¨Ø¹Ø¯ (Ù†Ù…Ø· Ù…ÙˆØ­Ø¯):**
```csharp
// Extension Method ÙÙŠ ServiceResultExtensions.cs
public static class ServiceResultExtensions
{
    public static IActionResult ToCreatedActionResult<T>(
        this ServiceResult<T> result, 
        string actionName, 
        object routeValues)
    {
        if (result.Success && result.Data != null)
        {
            return new CreatedAtActionResult(actionName, null, routeValues, result.Data);
        }
        return result.ToActionResult();
    }
}

// Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙˆØ­Ø¯ ÙÙŠ Ø¬Ù…ÙŠØ¹ Controllers
[HttpPost]
public async Task<IActionResult> CreateForm([FromBody] CreateFormBuilderDto createDto)
{
    var result = await _formBuilderService.CreateAsync(createDto);
    return result.ToCreatedActionResult(nameof(GetFormById), new { id = result.Data?.Id });
}
```

---

#### Ù…Ø«Ø§Ù„ 2: ØªÙˆØ­ÙŠØ¯ Update Response

**âŒ Ù‚Ø¨Ù„ (Ø£Ù†Ù…Ø§Ø· Ù…Ø®ØªÙ„ÙØ©):**
```csharp
// FormBuilderController.cs
[HttpPut("{id}")]
public async Task<IActionResult> UpdateForm(int id, [FromBody] UpdateFormBuilderDto updateDto)
{
    var result = await _formBuilderService.UpdateAsync(id, updateDto);
    if (result.Success)
    {
        return NoContent();
    }
    return result.ToActionResult();
}

// ProjectsController.cs
[HttpPut("{id}")]
public async Task<IActionResult> Update(int id, [FromBody] UpdateProjectDto updateDto)
{
    var result = await _projectService.UpdateAsync(id, updateDto);
    return result.ToActionResult(); // âŒ Ù„Ø§ ÙŠØ³ØªØ®Ø¯Ù… NoContent
}
```

**âœ… Ø¨Ø¹Ø¯ (Ù†Ù…Ø· Ù…ÙˆØ­Ø¯):**
```csharp
// Extension Method
public static IActionResult ToNoContentActionResult<T>(this ServiceResult<T> result)
{
    if (result.Success)
    {
        return new NoContentResult();
    }
    return result.ToActionResult();
}

// Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙˆØ­Ø¯
[HttpPut("{id}")]
public async Task<IActionResult> UpdateForm(int id, [FromBody] UpdateFormBuilderDto updateDto)
{
    var result = await _formBuilderService.UpdateAsync(id, updateDto);
    return result.ToNoContentActionResult();
}
```

---

## ğŸ“Š Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©

| Ø§Ù„ØªØ­Ø³ÙŠÙ† | Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù„ÙØ§Øª | Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© |
|---------|-------------|------------------|
| **1. ØªØ­ÙˆÙŠÙ„ FormulaService** | 3 | FormulaService.cs, FormulasController.cs, IFormulaService.cs |
| **2. Ø¥Ø²Ø§Ù„Ø© Try-Catch** | ~25 | Ø¬Ù…ÙŠØ¹ Controllers |
| **3. ØªÙˆØ­ÙŠØ¯ Namespaces** | ~100+ | Domain (~50), Services (~30), Controllers (~25) |
| **4. Ø¥Ø²Ø§Ù„Ø© GetById Ø¨Ø¹Ø¯ Create** | 3 | DocumentSeriesService.cs, FormulaService.cs, FormSubmissionService.cs |
| **5. ØªÙˆØ­ÙŠØ¯ Response Patterns** | ~25 | Ø¬Ù…ÙŠØ¹ Controllers |

---

**ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ±:** 2024-12-19
