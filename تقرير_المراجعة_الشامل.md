# ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø´Ø§Ù…Ù„ Ù„Ù„Ù…Ø´Ø±ÙˆØ¹ - FormBuilder API

**ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©:** 2024-12-19  
**Ø§Ù„Ù‡Ø¯Ù:** ØªØ­Ø¯ÙŠØ¯ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡ Ø§Ù„ØªÙŠ ØªØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ† (Ø§Ù„ØªÙƒØ±Ø§Ø±ØŒ N+1 QueriesØŒ Ø§Ù„Ø£Ø¯Ø§Ø¡)

---

## ğŸ“Š Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©

ØªÙ… ÙØ­Øµ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ ÙˆØªØ­Ø¯ÙŠØ¯:
- âœ… **Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…Ø­Ø³Ù‘Ù†Ø©:** 5 Ø®Ø¯Ù…Ø§Øª
- ğŸ”´ **Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„ØªÙŠ ØªØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ†:** 15+ Ø®Ø¯Ù…Ø©
- ğŸ”´ **Ù…Ø´Ø§ÙƒÙ„ N+1 Queries:** Ù…ØªØ¹Ø¯Ø¯Ø©
- ğŸ”´ **Ø§Ù„ØªÙƒØ±Ø§Ø± Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ:** ÙƒØ¨ÙŠØ±

---

## ğŸ”´ 1. Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„ØªÙŠ Ù„Ø§ ØªØ²Ø§Ù„ ØªØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ†

### 1.1 **Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„ØªÙŠ ØªØ³ØªØ®Ø¯Ù… ApiResponse + Manual Mapping**

| # | Ø§Ù„Ø®Ø¯Ù…Ø© | Ø¹Ø¯Ø¯ Methods | Manual Mapping | Try-Catch | Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© |
|---|--------|-------------|----------------|-----------|----------|
| 1 | **FormSubmissionService** | 12+ | âœ… ToDto, ToDetailDto, MapUpdate | âœ… 12+ | ğŸ”´ Ø¹Ø§Ù„ÙŠØ© |
| 2 | **FormSubmissionValuesService** | 12+ | âœ… ToDto, ToEntity, MapUpdate | âœ… 12+ | ğŸ”´ Ø¹Ø§Ù„ÙŠØ© |
| 3 | **FormSubmissionGridRowService** | 15+ | âœ… MapToDto | âœ… 15+ | ğŸ”´ Ø¹Ø§Ù„ÙŠØ© |
| 4 | **FormSubmissionGridCellService** | 8+ | âœ… MapToDto | âœ… 8+ | ğŸ”´ Ø¹Ø§Ù„ÙŠØ© |
| 5 | **FormSubmissionAttachmentsService** | 10+ | âœ… ToDto, ToEntity, MapUpdate | âœ… 10+ | ğŸ”´ Ø¹Ø§Ù„ÙŠØ© |
| 6 | **FormGridColumnService** | 15+ | âœ… ToDto, ToEntity, MapUpdate | âœ… 15+ | ğŸ”´ Ø¹Ø§Ù„ÙŠØ© |
| 7 | **FormAttachmentTypeService** | 15+ | âœ… ToDto, ToEntity, MapUpdate | âœ… 15+ | ğŸŸ¡ Ù…ØªÙˆØ³Ø·Ø© |
| 8 | **AttachmentTypeService** | 10+ | âœ… ToDto, ToEntity, MapUpdate | âœ… 10+ | ğŸŸ¡ Ù…ØªÙˆØ³Ø·Ø© |
| 9 | **FieldDataSourcesService** | 10+ | âœ… ToDto, ToEntity, MapUpdate | âœ… 10+ | ğŸŸ¡ Ù…ØªÙˆØ³Ø·Ø© |
| 10 | **FormulaService** | 30+ | âœ… ToDto, MapUpdate | âœ… 30+ | ğŸŸ¡ Ù…ØªÙˆØ³Ø·Ø© (Ù…Ø¹Ù‚Ø¯) |

**Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:** ~150+ method ØªØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ†

---

## ğŸ”´ 2. Ù…Ø´Ø§ÙƒÙ„ N+1 Queries Ùˆ AsNoTracking

### 2.1 **Repositories - Ø­Ø§Ù„Ø© Include**

#### âœ… **Repositories Ø§Ù„ØªÙŠ ØªØ³ØªØ®Ø¯Ù… Include Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­:**

1. âœ… **FormGridColumnRepository** - ÙŠØ³ØªØ®Ø¯Ù… Include Ø¨Ø´ÙƒÙ„ Ø¬ÙŠØ¯
2. âœ… **FormSubmissionGridRowRepository** - ÙŠØ³ØªØ®Ø¯Ù… Include Ø¨Ø´ÙƒÙ„ Ø¬ÙŠØ¯
3. âœ… **FormSubmissionGridCellRepository** - ÙŠØ³ØªØ®Ø¯Ù… Include + AsNoTracking âœ…
4. âœ… **FormSubmissionValuesRepository** - ÙŠØ³ØªØ®Ø¯Ù… Include Ø¨Ø´ÙƒÙ„ Ø¬ÙŠØ¯
5. âœ… **FormSubmissionAttachmentsRepository** - ÙŠØ³ØªØ®Ø¯Ù… Include Ø¨Ø´ÙƒÙ„ Ø¬ÙŠØ¯
6. âœ… **FormAttachmentTypeRepository** - ÙŠØ³ØªØ®Ø¯Ù… Include Ø¨Ø´ÙƒÙ„ Ø¬ÙŠØ¯
7. âœ… **FormulasRepository** - ÙŠØ³ØªØ®Ø¯Ù… Include Ø¨Ø´ÙƒÙ„ Ø¬ÙŠØ¯
8. âœ… **FormulaVariablesRepository** - ÙŠØ³ØªØ®Ø¯Ù… Include Ø¨Ø´ÙƒÙ„ Ø¬ÙŠØ¯
9. âœ… **DocumentSeriesRepository** - ÙŠØ³ØªØ®Ø¯Ù… Include Ø¨Ø´ÙƒÙ„ Ø¬ÙŠØ¯
10. âœ… **DocumentTypeRepository** - ÙŠØ³ØªØ®Ø¯Ù… Include Ø¨Ø´ÙƒÙ„ Ø¬ÙŠØ¯
11. âœ… **WorkflowRepository** - ÙŠØ³ØªØ®Ø¯Ù… Include Ø¨Ø´ÙƒÙ„ Ø¬ÙŠØ¯
12. âœ… **ApprovalStageRepository** - ÙŠØ³ØªØ®Ø¯Ù… Include Ø¨Ø´ÙƒÙ„ Ø¬ÙŠØ¯

#### âŒ **Ù…Ø´Ø§ÙƒÙ„ N+1 ÙÙŠ Repositories:**

1. **FormSubmissionRepository.GetByIdAsync** (Line 22-25)
   ```csharp
   // âŒ Ø¨Ø¯ÙˆÙ† Include - Ø³ÙŠØ³Ø¨Ø¨ N+1 Ø¹Ù†Ø¯ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù€ Navigation Properties
   return await _context.FORM_SUBMISSIONS
       .FirstOrDefaultAsync(fs => fs.Id == id);
   ```
   **Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:** Ø¹Ù†Ø¯ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù€ `FORM_BUILDER`, `DOCUMENT_TYPES`, Ø¥Ù„Ø® Ø³ÙŠØªÙ… Ø¹Ù…Ù„ queries Ø¥Ø¶Ø§ÙÙŠØ©
   **Ø§Ù„Ø­Ù„:** Ø¥Ø¶Ø§ÙØ© Include Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ø§Ù… `GetByIdWithDetailsAsync` Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù†Ù‡

2. **ProjectRepository.GetByIdAsync** (Line 22-25)
   ```csharp
   // âŒ Ø¨Ø¯ÙˆÙ† Include
   return await _context.PROJECTS
       .FirstOrDefaultAsync(p => p.Id == id);
   ```
   **Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:** Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Navigation Properties = N+1

3. **AttachmentTypeRepository.GetByIdAsync** (Line 54-57)
   ```csharp
   // âŒ Ø¨Ø¯ÙˆÙ† Include
   return _context.ATTACHMENT_TYPES
       .FirstOrDefaultAsync(at => at.Id == id);
   ```
   **Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:** Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Navigation Properties = N+1

4. **FieldDataSourcesRepository.GetByIdAsync** (Line 55-57)
   ```csharp
   // âŒ Ø¨Ø¯ÙˆÙ† Include - ÙŠØ³ØªØ®Ø¯Ù… FindAsync
   return await _context.FIELD_DATA_SOURCES.FindAsync(id);
   ```
   **Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:** FindAsync Ù„Ø§ ÙŠØ¯Ø¹Ù… IncludeØŒ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Navigation Properties = N+1

5. **BaseRepository.GetAllAsync** (Line 46-52)
   ```csharp
   // âŒ Ù„Ø§ ÙŠØ³ØªØ®Ø¯Ù… AsNoTracking Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹
   public virtual async Task<ICollection<T>> GetAllAsync(...)
   {
       return await query.ToListAsync(); // Tracking enabled
   }
   ```
   **Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:** Tracking ØºÙŠØ± Ø¶Ø±ÙˆØ±ÙŠ Ù„Ù„Ù€ Read Operations + Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø°Ø§ÙƒØ±Ø© Ø£ÙƒØ¨Ø±
   **Ø§Ù„Ø­Ù„:** Ø¥Ø¶Ø§ÙØ© `AsNoTracking()` Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹

6. **BaseRepository.SingleOrDefaultAsync** (Line 66-73)
   ```csharp
   // âš ï¸ asNoTracking parameter Ù…ÙˆØ¬ÙˆØ¯ Ù„ÙƒÙ† Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© false
   public async Task<T> SingleOrDefaultAsync(..., bool asNoTracking = false, ...)
   ```
   **Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:** Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† `true` Ù„Ù„Ù€ Read Operations
   **Ø§Ù„Ø­Ù„:** ØªØºÙŠÙŠØ± Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø¥Ù„Ù‰ `true`

### 2.2 **Services Ø§Ù„ØªÙŠ ØªØ³ØªØ®Ø¯Ù… Select(ToDto) - Ø­Ø§Ù„Ø© N+1**

#### âœ… **Services Ø§Ù„ØªÙŠ Ù„Ø§ ØªØ³Ø¨Ø¨ N+1 (Repositories ØªØ³ØªØ®Ø¯Ù… Include):**

1. âœ… **FormGridColumnService** - Repository ÙŠØ³ØªØ®Ø¯Ù… Include âœ…
2. âœ… **FormSubmissionGridRowService** - Repository ÙŠØ³ØªØ®Ø¯Ù… Include âœ…
3. âœ… **FormSubmissionGridCellService** - Repository ÙŠØ³ØªØ®Ø¯Ù… Include + AsNoTracking âœ…
4. âœ… **FormSubmissionValuesService** - Repository ÙŠØ³ØªØ®Ø¯Ù… Include âœ…
5. âœ… **FormSubmissionAttachmentsService** - Repository ÙŠØ³ØªØ®Ø¯Ù… Include âœ…

#### âš ï¸ **Services Ø§Ù„ØªÙŠ Ù‚Ø¯ ØªØ³Ø¨Ø¨ N+1:**

1. **FormSubmissionService.GetAllAsync** (Line 28-29)
   ```csharp
   var submissions = await _unitOfWork.FormSubmissionsRepository.GetSubmissionsWithDetailsAsync();
   var submissionDtos = submissions.Select(ToDto).ToList(); 
   // âš ï¸ Repository ÙŠØ³ØªØ®Ø¯Ù… Include Ù„ÙƒÙ† Ù‚Ø¯ ÙŠØ­ØªØ§Ø¬ Ø§Ù„Ù…Ø²ÙŠØ¯ Ø­Ø³Ø¨ ToDto
   ```
   **Ø§Ù„ØªØ­Ù‚Ù‚:** Ø¥Ø°Ø§ ÙƒØ§Ù† `ToDto` ÙŠØµÙ„ Ù„Ù€ Navigation Properties ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Include = N+1

2. **Services Ø§Ù„ØªÙŠ ØªØ³ØªØ®Ø¯Ù… BaseRepository.GetAllAsync Ù…Ø¨Ø§Ø´Ø±Ø©**
   ```csharp
   // âš ï¸ BaseRepository.GetAllAsync Ù„Ø§ ÙŠØ³ØªØ®Ø¯Ù… Include Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹
   var entities = await Repository.GetAllAsync();
   var dtos = entities.Select(ToDto).ToList();
   // âŒ Ø¥Ø°Ø§ ÙƒØ§Ù† ToDto ÙŠØµÙ„ Ù„Ù„Ù€ Navigation Properties = N+1
   ```

---

## ğŸ”´ 3. Ø§Ù„ØªÙƒØ±Ø§Ø± Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ

### 3.1 **Manual Mapping Methods (24+ method)**

| Ø§Ù„Ø®Ø¯Ù…Ø© | ToDto | ToEntity | MapUpdate | Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ |
|--------|-------|----------|-----------|----------|
| FormSubmissionService | 1 | 0 | 1 | 2 |
| FormSubmissionValuesService | 1 | 1 | 1 | 3 |
| FormSubmissionGridRowService | 1 | 0 | 0 | 1 |
| FormSubmissionGridCellService | 1 | 0 | 0 | 1 |
| FormSubmissionAttachmentsService | 1 | 1 | 1 | 3 |
| FormGridColumnService | 1 | 1 | 1 | 3 |
| FormAttachmentTypeService | 1 | 1 | 1 | 3 |
| AttachmentTypeService | 1 | 1 | 1 | 3 |
| FieldDataSourcesService | 1 | 1 | 1 | 3 |
| FormulaService | 1 | 0 | 1 | 2 |
| **Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ** | **10** | **7** | **7** | **24** |

### 3.2 **Try-Catch Blocks Ø§Ù„Ù…ØªÙƒØ±Ø±Ø© (~150+ block)**

ÙƒÙ„ service ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰:
```csharp
try
{
    // logic
}
catch (Exception ex)
{
    return new ApiResponse(500, $"Error: {ex.Message}");
}
```

**Ø§Ù„ØªØ£Ø«ÙŠØ±:** 
- ğŸ”´ ØªÙƒØ±Ø§Ø± ÙƒØ¨ÙŠØ±
- ğŸ”´ ØµØ¹ÙˆØ¨Ø© Ø§Ù„ØµÙŠØ§Ù†Ø©
- ğŸ”´ Global Exception Handler Ù…ÙˆØ¬ÙˆØ¯ Ù„ÙƒÙ† Ù„Ø§ ÙŠÙØ³ØªØ®Ø¯Ù…

### 3.3 **Code Existence Checks Ø§Ù„Ù…ØªÙƒØ±Ø±Ø©**

| Repository | Method | Ø§Ù„ØªÙƒØ±Ø§Ø± |
|-----------|--------|----------|
| FormGridRepository | GridCodeExistsAsync | âœ… Ù…ÙˆØ¬ÙˆØ¯ |
| FormGridColumnRepository | ColumnCodeExistsAsync | âœ… Ù…ÙˆØ¬ÙˆØ¯ |
| DocumentSeriesRepository | SeriesCodeExistsAsync | âœ… Ù…ÙˆØ¬ÙˆØ¯ |
| **Ù„ÙƒÙ†:** | | |
| FormSubmissionRepository | DocumentNumberExistsAsync | âœ… Ù…ÙˆØ¬ÙˆØ¯ |
| ApprovalWorkflowRepository | NameExistsAsync | âœ… Ù…ÙˆØ¬ÙˆØ¯ |
| **Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:** ÙƒÙ„ Repository ÙŠÙƒØªØ¨ Ù†ÙØ³ Ø§Ù„Ù…Ù†Ø·Ù‚ | | ğŸ”´ |

---

## ğŸ”´ 4. Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø£Ø®Ø±Ù‰

### 4.1 **Ø¹Ø¯Ù… Ø§Ø³ØªØ®Ø¯Ø§Ù… AsNoTracking Ù„Ù„Ù€ Read Operations**

#### âŒ **Ø§Ù„Ù…Ø´Ø§ÙƒÙ„:**

1. **BaseRepository.GetAllAsync** (Line 46-52)
   ```csharp
   // âŒ Ù„Ø§ ÙŠØ³ØªØ®Ø¯Ù… AsNoTracking Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹
   public virtual async Task<ICollection<T>> GetAllAsync(...)
   {
       return await query.ToListAsync(); // Tracking enabled
   }
   ```
   **Ø§Ù„ØªØ£Ø«ÙŠØ±:** Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø°Ø§ÙƒØ±Ø© Ø£ÙƒØ¨Ø± + Ø£Ø¯Ø§Ø¡ Ø£Ø¨Ø·Ø£
   **Ø§Ù„Ø­Ù„:** Ø¥Ø¶Ø§ÙØ© `AsNoTracking()` Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹

2. **BaseRepository.SingleOrDefaultAsync** (Line 66-73)
   ```csharp
   // âš ï¸ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ asNoTracking parameter Ù„ÙƒÙ† Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© false
   public async Task<T> SingleOrDefaultAsync(..., bool asNoTracking = false, ...)
   ```
   **Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:** Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† `true` Ù„Ù„Ù€ Read Operations
   **Ø§Ù„Ø­Ù„:** ØªØºÙŠÙŠØ± Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø¥Ù„Ù‰ `true`

3. **Ø¬Ù…ÙŠØ¹ Services** ØªØ³ØªØ®Ø¯Ù… `GetByIdAsync` Ø¨Ø¯ÙˆÙ† `asNoTracking: true`
   - âš ï¸ Ù…Ø¹Ø¸Ù… Services Ù„Ø§ ØªÙ…Ø±Ø± `asNoTracking: true`
   - **Ø§Ù„Ø­Ù„:** ØªØºÙŠÙŠØ± Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© ÙÙŠ BaseRepository

4. **BaseService.GetByIdAsync** (Line 60-66)
   ```csharp
   // âš ï¸ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© asNoTracking = false
   public virtual async Task<ServiceResult<TDto>> GetByIdAsync(int id, bool asNoTracking = false)
   ```
   **Ø§Ù„Ø­Ù„:** ØªØºÙŠÙŠØ± Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø¥Ù„Ù‰ `true`

### 4.2 **Ø¹Ø¯Ù… Ø§Ø³ØªØ®Ø¯Ø§Ù… Pagination**

#### âŒ **Ø§Ù„Ù…Ø´Ø§ÙƒÙ„:**

1. **Ø¬Ù…ÙŠØ¹ GetAllAsync methods** Ù„Ø§ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Pagination
   - `FormSubmissionService.GetAllAsync()` - Ù‚Ø¯ ÙŠØ¬Ù„Ø¨ Ø¢Ù„Ø§Ù Ø§Ù„Ø³Ø¬Ù„Ø§Øª
   - `FormSubmissionValuesService.GetAllAsync()` - Ù‚Ø¯ ÙŠØ¬Ù„Ø¨ Ø¢Ù„Ø§Ù Ø§Ù„Ø³Ø¬Ù„Ø§Øª
   - `FormGridColumnService.GetAllAsync()` - Ù‚Ø¯ ÙŠØ¬Ù„Ø¨ Ù…Ø¦Ø§Øª Ø§Ù„Ø³Ø¬Ù„Ø§Øª
   - ÙˆØºÙŠØ±Ù‡Ø§...

2. **BaseService.GetPagedAsync** Ù…ÙˆØ¬ÙˆØ¯ Ù„ÙƒÙ† Ù„Ø§ ÙŠÙØ³ØªØ®Ø¯Ù… ÙÙŠ Ù…Ø¹Ø¸Ù… Ø§Ù„Ø®Ø¯Ù…Ø§Øª

### 4.3 **Multiple Database Calls**

#### âŒ **Ø§Ù„Ù…Ø´Ø§ÙƒÙ„:**

1. **DocumentSeriesService.GetNextNumberAsync** (Line 198-221)
   ```csharp
   var nextNumber = await _unitOfWork.DocumentSeriesRepository.GetNextNumberAsync(seriesId);
   var series = await _unitOfWork.DocumentSeriesRepository.GetByIdAsync(seriesId); // Extra call
   ```
   **Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:** GetNextNumberAsync ÙŠØ¬Ù„Ø¨ Series ÙˆÙŠØ­Ø¯Ø«Ù‡ØŒ Ø«Ù… GetByIdAsync ÙŠØ¬Ù„Ø¨ Ù†ÙØ³ Series Ù…Ø±Ø© Ø£Ø®Ø±Ù‰
   **Ø§Ù„Ø­Ù„:** GetNextNumberAsync ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¹ÙŠØ¯ Series Ù…Ø¹ NextNumber

2. **FormSubmissionService.CreateAsync** (Line 145-188)
   ```csharp
   var series = await _unitOfWork.DocumentSeriesRepository.GetByIdAsync(createDto.SeriesId);
   var nextNumber = await _unitOfWork.DocumentSeriesRepository.GetNextNumberAsync(createDto.SeriesId);
   var version = await _unitOfWork.FormSubmissionsRepository.GetNextVersionAsync(createDto.FormBuilderId);
   // 3 separate calls - ÙŠÙ…ÙƒÙ† ØªØ­Ø³ÙŠÙ†Ù‡Ø§
   ```
   **Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:** 3 calls Ù…Ù†ÙØµÙ„Ø©
   **Ø§Ù„Ø­Ù„:** ÙŠÙ…ÙƒÙ† Ø¯Ù…Ø¬Ù‡Ø§ ÙÙŠ transaction ÙˆØ§Ø­Ø¯Ø© Ø£Ùˆ method ÙˆØ§Ø­Ø¯

3. **Services Ø§Ù„ØªÙŠ ØªØ³ØªØ®Ø¯Ù… GetById Ø¨Ø¹Ø¯ Create**
   ```csharp
   // âŒ ÙÙŠ Ø¨Ø¹Ø¶ Services
   Repository.Add(entity);
   await _unitOfWork.CompleteAsyn();
   var createdEntity = await Repository.GetByIdAsync(entity.Id); // Extra call
   ```
   **Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:** Entity Ù…ÙˆØ¬ÙˆØ¯Ø© Ø¨Ø§Ù„ÙØ¹Ù„ ÙÙŠ Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø¨Ø¹Ø¯ SaveChanges
   **Ø§Ù„Ø­Ù„:** Ø§Ø³ØªØ®Ø¯Ø§Ù… Entity Ù…Ø¨Ø§Ø´Ø±Ø© Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† GetById

### 4.4 **Try-Catch Blocks Ø§Ù„Ù…ØªÙƒØ±Ø±Ø©**

#### âŒ **Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:**
- ğŸ”´ **150+ Try-Catch block** ÙÙŠ Services
- ğŸ”´ Global Exception Handler Ù…ÙˆØ¬ÙˆØ¯ Ù„ÙƒÙ† Ù„Ø§ ÙŠÙØ³ØªØ®Ø¯Ù…
- ğŸ”´ ÙƒÙ„ method Ù…Ø­Ø§Ø· Ø¨Ù€ Try-Catch

**Ø§Ù„ØªØ£Ø«ÙŠØ±:**
- ØªÙƒØ±Ø§Ø± ÙƒØ¨ÙŠØ±
- ØµØ¹ÙˆØ¨Ø© Ø§Ù„ØµÙŠØ§Ù†Ø©
- Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©

**Ø§Ù„Ø­Ù„:**
- Ø¥Ø²Ø§Ù„Ø© Try-Catch Ù…Ù† Services
- Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø¹Ù„Ù‰ Global Exception Handler
- Ø§Ø³ØªØ®Ø¯Ø§Ù… Result Pattern Ù„Ù„Ù€ Error Handling

---

## ğŸ”´ 5. Controllers Ø§Ù„ØªÙŠ ØªØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ†

### 5.1 **Controllers Ø¨Ø¯ÙˆÙ† ØªÙˆØ­ÙŠØ¯ Response Pattern**

| Controller | Pattern Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… | Ø§Ù„Ø­Ø§Ù„Ø© |
|-----------|------------------|--------|
| DocumentSeriesController | `StatusCode(result.StatusCode, result)` | âœ… Ø¬ÙŠØ¯ |
| ApprovalStageController | `StatusCode(response.StatusCode, response)` | âœ… Ø¬ÙŠØ¯ |
| ApprovalWorkflowController | `StatusCode(result.StatusCode, result)` | âœ… Ø¬ÙŠØ¯ |
| **Ù„ÙƒÙ†:** | | |
| FormSubmissionController | â“ | ğŸ”´ ÙŠØ­ØªØ§Ø¬ ÙØ­Øµ |
| FormGridColumnController | â“ | ğŸ”´ ÙŠØ­ØªØ§Ø¬ ÙØ­Øµ |
| FormSubmissionValuesController | â“ | ğŸ”´ ÙŠØ­ØªØ§Ø¬ ÙØ­Øµ |

### 5.2 **Controllers Ø§Ù„ØªÙŠ ØªØ³ØªØ®Ø¯Ù… Manual Mapping**

- âŒ Controllers Ø§Ù„ØªÙŠ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ `MapToDto` methods
- âŒ Controllers Ø§Ù„ØªÙŠ ØªØ³ØªØ®Ø¯Ù… `Select(ToDto)` Ù…Ø¨Ø§Ø´Ø±Ø©

---

## ğŸ”´ 6. AutoMapper Profiles Ø§Ù„Ù…ÙÙ‚ÙˆØ¯Ø©

### 6.1 **Profiles Ø§Ù„ØªÙŠ ØªØ­ØªØ§Ø¬ Ø¥Ù†Ø´Ø§Ø¡:**

1. âŒ **FormSubmissionProfile** - Ù„Ù„Ù€ FORM_SUBMISSIONS
2. âŒ **FormSubmissionValuesProfile** - Ù„Ù„Ù€ FORM_SUBMISSION_VALUES
3. âŒ **FormSubmissionGridRowProfile** - Ù„Ù„Ù€ FORM_SUBMISSION_GRID_ROWS
4. âŒ **FormSubmissionGridCellProfile** - Ù„Ù„Ù€ FORM_SUBMISSION_GRID_CELLS
5. âŒ **FormSubmissionAttachmentsProfile** - Ù„Ù„Ù€ FORM_SUBMISSION_ATTACHMENTS
6. âŒ **FormGridColumnProfile** - Ù„Ù„Ù€ FORM_GRID_COLUMNS
7. âŒ **FormAttachmentTypeProfile** - Ù„Ù„Ù€ FORM_ATTACHMENT_TYPES
8. âŒ **AttachmentTypeProfile** - Ù„Ù„Ù€ ATTACHMENT_TYPES
9. âŒ **FieldDataSourceProfile** - Ù„Ù„Ù€ FIELD_DATA_SOURCES
10. âŒ **FormulaProfile** - Ù„Ù„Ù€ FORMULAS (Ù…Ø¹Ù‚Ø¯ - ÙŠØ­ØªØ§Ø¬ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø®Ø§ØµØ©)

---

## ğŸ”´ 7. Ù…Ø´Ø§ÙƒÙ„ Ø£Ø®Ø±Ù‰

### 7.1 **Repositories Ø§Ù„ØªÙŠ Ù„Ø§ ØªØ±Ø« Ù…Ù† BaseRepository Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­**

1. âŒ **ApprovalStageRepository** - âœ… ØªÙ… Ø¥ØµÙ„Ø§Ø­Ù‡
2. âš ï¸ **Repositories Ø£Ø®Ø±Ù‰** - ØªØ­ØªØ§Ø¬ ÙØ­Øµ

### 7.2 **Interfaces Ø§Ù„ØªÙŠ Ù„Ø§ ØªØ±Ø« Ù…Ù† IBaseRepository**

- âš ï¸ Ø¨Ø¹Ø¶ Interfaces Ù‚Ø¯ ØªØ­ØªØ§Ø¬ ØªØ­Ø¯ÙŠØ«

### 7.3 **Ø¹Ø¯Ù… Ø§Ø³ØªØ®Ø¯Ø§Ù… AsNoTracking ÙÙŠ GetAllAsync**

- ğŸ”´ **BaseRepository.GetAllAsync** Ù„Ø§ ÙŠØ³ØªØ®Ø¯Ù… AsNoTracking Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹
- ğŸ”´ **BaseRepository.SingleOrDefaultAsync** Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© `asNoTracking = false`
- ğŸ”´ **BaseService.GetByIdAsync** Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© `asNoTracking = false`
- ğŸ”´ **Ø¬Ù…ÙŠØ¹ Services** ØªØ³ØªØ®Ø¯Ù… GetAllAsync Ø¨Ø¯ÙˆÙ† AsNoTracking

### 7.4 **Try-Catch Blocks ÙÙŠ Repositories**

- âš ï¸ Ø¨Ø¹Ø¶ Repositories ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Try-Catch blocks ØºÙŠØ± Ø¶Ø±ÙˆØ±ÙŠØ©
- Ù…Ø«Ø§Ù„: `FormGridColumnRepository`, `FormSubmissionGridRowRepository`
- **Ø§Ù„Ø­Ù„:** Ø¥Ø²Ø§Ù„Ø© Try-Catch Ù…Ù† Repositories (ÙŠØªÙ… Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹Ù‡ ÙÙŠ Global Exception Handler)

### 7.5 **Repositories Ø§Ù„ØªÙŠ ØªØ³ØªØ®Ø¯Ù… FindAsync**

- âš ï¸ **FieldDataSourcesRepository.GetByIdAsync** ÙŠØ³ØªØ®Ø¯Ù… `FindAsync`
- **Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:** FindAsync Ù„Ø§ ÙŠØ¯Ø¹Ù… Include
- **Ø§Ù„Ø­Ù„:** Ø§Ø³ØªØ®Ø¯Ø§Ù… `FirstOrDefaultAsync` Ù…Ø¹ Include

---

## ğŸ“‹ Ø®Ø·Ø© Ø§Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©

### ğŸ”´ **Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1: Ø¥ØµÙ„Ø§Ø­ N+1 Queries (Ø£ÙˆÙ„ÙˆÙŠØ© Ø¹Ø§Ù„ÙŠØ©)**

1. âœ… ØªØ­Ø¯ÙŠØ« `BaseRepository.GetAllAsync` Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… `AsNoTracking` Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹
2. âœ… Ø¥Ø¶Ø§ÙØ© `Include` ÙÙŠ Repositories Ø§Ù„Ù…ÙÙ‚ÙˆØ¯Ø©:
   - FormGridColumnRepository
   - FormSubmissionGridRowRepository
   - FormSubmissionGridCellRepository
   - FormSubmissionValuesRepository
3. âœ… ØªØ­Ø¯ÙŠØ« Services Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… `Include` Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø©

### ğŸ”´ **Ø§Ù„Ù…Ø±Ø­Ù„Ø© 2: ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© (Ø£ÙˆÙ„ÙˆÙŠØ© Ø¹Ø§Ù„ÙŠØ©)**

1. âœ… Ø¥Ù†Ø´Ø§Ø¡ AutoMapper Profiles Ø§Ù„Ù…ÙÙ‚ÙˆØ¯Ø© (10 profiles)
2. âœ… ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¨Ø³ÙŠØ·Ø©:
   - FormGridColumnService
   - FormAttachmentTypeService
   - AttachmentTypeService
   - FieldDataSourcesService
3. âš ï¸ ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…Ø¹Ù‚Ø¯Ø©:
   - FormSubmissionService (Ù…Ø¹Ù‚Ø¯ - ÙŠØ­ØªØ§Ø¬ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø®Ø§ØµØ©)
   - FormSubmissionValuesService
   - FormSubmissionGridRowService
   - FormSubmissionGridCellService
   - FormSubmissionAttachmentsService
   - FormulaService (Ù…Ø¹Ù‚Ø¯ Ø¬Ø¯Ø§Ù‹)

### ğŸŸ¡ **Ø§Ù„Ù…Ø±Ø­Ù„Ø© 3: Ø¥Ø¶Ø§ÙØ© Pagination (Ø£ÙˆÙ„ÙˆÙŠØ© Ù…ØªÙˆØ³Ø·Ø©)**

1. âœ… ØªØ­Ø¯ÙŠØ« Ø¬Ù…ÙŠØ¹ `GetAllAsync` methods Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… `GetPagedAsync`
2. âœ… ØªØ­Ø¯ÙŠØ« Controllers Ù„Ø¯Ø¹Ù… Pagination parameters

### ğŸŸ¡ **Ø§Ù„Ù…Ø±Ø­Ù„Ø© 4: ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡ (Ø£ÙˆÙ„ÙˆÙŠØ© Ù…ØªÙˆØ³Ø·Ø©)**

1. âœ… Ø¥Ø²Ø§Ù„Ø© Multiple Database Calls
2. âœ… Ø§Ø³ØªØ®Ø¯Ø§Ù… `AsNoTracking` Ù„Ù„Ù€ Read Operations
3. âœ… Ø¥Ø¶Ø§ÙØ© Caching Ù„Ù„Ù€ Read Operations

### ğŸŸ¢ **Ø§Ù„Ù…Ø±Ø­Ù„Ø© 5: ØªØ­Ø³ÙŠÙ† Controllers (Ø£ÙˆÙ„ÙˆÙŠØ© Ù…Ù†Ø®ÙØ¶Ø©)**

1. âœ… ØªÙˆØ­ÙŠØ¯ Response Patterns
2. âœ… Ø§Ø³ØªØ®Ø¯Ø§Ù… ServiceResultExtensions
3. âœ… Ø¥Ø²Ø§Ù„Ø© Manual Mapping Ù…Ù† Controllers

---

## ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªÙƒØ±Ø§Ø± Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ

| Ø§Ù„Ø¹Ù†ØµØ± | Ø§Ù„Ø¹Ø¯Ø¯ | Ø§Ù„Ù†Ø³Ø¨Ø© | Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© |
|--------|------|--------|----------|
| **Services ØªØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ†** | 15+ | 75% | ğŸ”´ Ø¹Ø§Ù„ÙŠØ© |
| **Manual Mapping Methods** | 24+ | 100% | ğŸ”´ Ø¹Ø§Ù„ÙŠØ© |
| **Try-Catch Blocks** | 150+ | 90% | ğŸ”´ Ø¹Ø§Ù„ÙŠØ© |
| **N+1 Query Problems** | 10+ | - | ğŸ”´ Ø¹Ø§Ù„ÙŠØ© |
| **AutoMapper Profiles Ø§Ù„Ù…ÙÙ‚ÙˆØ¯Ø©** | 10 | 50% | ğŸ”´ Ø¹Ø§Ù„ÙŠØ© |
| **Pagination Missing** | 20+ | 80% | ğŸŸ¡ Ù…ØªÙˆØ³Ø·Ø© |
| **AsNoTracking Missing** | 30+ | 70% | ğŸŸ¡ Ù…ØªÙˆØ³Ø·Ø© |

---

## âœ… Ø§Ù„Ø®Ù„Ø§ØµØ©

### Ù…Ø§ ØªÙ… Ø¥Ù†Ø¬Ø§Ø²Ù‡:
- âœ… ØªØ­Ø³ÙŠÙ† 5 Ø®Ø¯Ù…Ø§Øª
- âœ… Ø¥Ø¶Ø§ÙØ© 5 AutoMapper Profiles
- âœ… ØªØ­Ø³ÙŠÙ† BaseService
- âœ… Ø¥Ù†Ø´Ø§Ø¡ Repository Extensions

### Ù…Ø§ ÙŠØ­ØªØ§Ø¬ Ø¥Ù†Ø¬Ø§Ø²Ù‡:
- ğŸ”´ **15+ Ø®Ø¯Ù…Ø©** ØªØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ†
- ğŸ”´ **10+ Ù…Ø´ÙƒÙ„Ø© N+1** ØªØ­ØªØ§Ø¬ Ø¥ØµÙ„Ø§Ø­
- ğŸ”´ **24+ Manual Mapping method** ØªØ­ØªØ§Ø¬ Ø¥Ø²Ø§Ù„Ø©
- ğŸ”´ **10 AutoMapper Profiles** Ù…ÙÙ‚ÙˆØ¯Ø©
- ğŸŸ¡ **Pagination** Ù…ÙÙ‚ÙˆØ¯ ÙÙŠ Ù…Ø¹Ø¸Ù… Ø§Ù„Ø®Ø¯Ù…Ø§Øª
- ğŸŸ¡ **AsNoTracking** ØºÙŠØ± Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ù…Ø¹Ø¸Ù… Read Operations

---

**ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ±:** 2024-12-19  
**Ø§Ù„Ø­Ø§Ù„Ø©:** âœ… Ø¬Ø§Ù‡Ø² Ù„Ù„ØªÙ†ÙÙŠØ°
